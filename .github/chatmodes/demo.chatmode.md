---
description: 'Disciplined Foresight: Modularizing capi-mcp-server with fastmcp-template Patterns'
tools: ['changes', 'codebase', 'editFiles', 'extensions', 'fetch', 'findTestFiles', 'githubRepo', 'new', 'openSimpleBrowser', 'problems', 'runCommands', 'runNotebooks', 'runTasks', 'runTests', 'search', 'searchResults', 'terminalLastCommand', 'terminalSelection', 'testFailure', 'usages', 'vscodeAPI', 'fastmcp Docs', 'capi-mcp-server', 'websearch']
---
# DeepCog Disciplined Foresight: Modularizing capi-mcp-server with fastmcp-template Patterns

## Context
- **Project Goal:** Expose the VSCode `capi` CLI as a Model Context Protocol (MCP) server, enabling agent-driven automation and observability with minimal human intervention.
- **Current State:**
  - `capi-mcp-server` is a single-file Python MCP server using `FastMCP` and direct tool decorators.
  - The `fastmcp-template` provides a modular, registry-driven, and extensible server architecture.
- **Intent:**
  - Refactor `capi-mcp-server` to use the modular, registry-based approach from `fastmcp-template` for long-term maintainability, extensibility, and agent compatibility.

## Why Disciplined Foresight?
- **Reason:** Ensures the refactor is logically sound, modular, and robust for future growth.
- **Memory:** Leverages best practices from the template and prior MCP/LLM server architectures.
- **Will:** Drives purposeful actionâ€”scaffolding a maintainable, extensible, and agent-friendly server.

## Step-by-Step Plan
1. **Directory Structure:**
   - Create `app/` with `tools.py`, `resources.py`, `prompts.py`, and `__init__.py`.
   - Move tool logic from `server.py` to `app/tools.py`.
   - Add a `register_tools(server)` function for dynamic tool registration.
2. **Entrypoint Refactor:**
   - Update `server.py` to instantiate `FastMCP`, call `register_tools`, and run the server.
   - Prepare for future `register_resources` and `register_prompts`.
3. **Registry Pattern:**
   - Use a list of tool definitions (name, description, factory) for easy extension and testability.
   - Register each tool dynamically in `register_tools`.
4. **Extensibility:**
   - The same pattern can be used for resources and prompts, supporting future agent workflows and LLM integrations.
5. **Testing & TDD:**
   - Structure supports adding a `tests/` directory for incremental, test-driven development.

## Recap TL;DR
- **Refactor** `capi-mcp-server` to use a modular, registry-driven architecture inspired by `fastmcp-template`.
- **Goal:** Long-term maintainability, extensibility, and agent/LLM compatibility.
- **Pattern:** Move tool logic to `app/tools.py`, use `register_tools`, and keep `server.py` minimal and declarative.
- **Outcome:** A future-proof, agent-friendly MCP server ready for rapid iteration and onboarding.

---

*This document was generated by DeepCog using the Disciplined Foresight perspective to ensure strategic, maintainable, and extensible architecture for agent-driven automation.*
